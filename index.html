<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nextcloud Foto Uploader</title>
    <style>
        /* Basic Reset & Mobile First */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            padding: 0px;
            background-color: #fff;
            color: #333;
        }

        .container { max-width: 600px; margin: 0px auto; background: #fff; padding: 25px; border-radius: 8px; /*box-shadow: 0 2px 10px rgba(0,0,0,0.1);*/ }
        h1 { text-align: center; color: #006aa7; }

        /* Input & Button Styling */
        .input-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="password"], button {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px; /* Prevent iOS zoom */
            margin-bottom: 5px; /* Space below inputs */
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 10px; /* Space above buttons */
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Specific Buttons */
        #select-file-button { /* Style the button that triggers the hidden input */
             background-color: #6c757d;
        }
         #select-file-button:hover:not(:disabled) {
             background-color: #5a6268;
         }
        #capture-photo {
            background-color: #28a745;
        }
        #capture-photo:hover:not(:disabled) {
             background-color: #218838;
         }
         #upload-button {
             background-color: #ffc107;
             color: #333;
         }
         #upload-button:hover:not(:disabled) {
             background-color: #e0a800;
         }
         /* NEU: Delete Button */
         #delete-photo-button {
             background-color: #dc3545;
             margin-top: 5px;
         }
         #delete-photo-button:hover:not(:disabled) {
             background-color: #c82333;
         }
         /* NEU: Taschenlampe Button */
         #toggle-flashlight {
             background-color: #6c757d;
             margin-top: 10px;
         }
         #toggle-flashlight:hover:not(:disabled) {
             background-color: #5a6268;
         }
         #capture-buttons-container {
             display: flex;
             justify-content: space-between;
             gap: 10px;
         }
         #capture-buttons-container button {
             width: auto;
             flex-grow: 1;
         }

        /* Camera & Preview */
        #video, #canvas, #photo-preview {
            max-width: 100%;
            border: 1px solid #eee;
            margin-top: 15px;
            border-radius: 5px;
        }
        #video, #canvas, #photo-preview {
             display: none; /* Initially hidden */
        }
         #photo-preview.visible {
             display: block; /* Show when needed */
         }

        /* NEU: Video-Container mit 2:3 Seitenverhältnis */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 150%; /* 2 / 3 = 0.6667 -> 1.5 -> 150%  (für 3:2 andersrum)*/
            height: 0;
            overflow: hidden;
            margin: 0 auto;
            border-radius: 5px;
            border: 1px solid #eee;
            margin-top: 15px;
        }
        .video-container #video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
            transition: transform 0.2s ease-in-out;
            display: none;
        }
        .video-container #video.visible {
            display: block;
        }

        /* NEU: Thumbnails */
        #thumbnails-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            border: 1px dashed #ccc;
            padding: 10px;
            border-radius: 5px;
            min-height: 80px; /* Space for thumbnails */
            align-items: center;
        }
        .thumbnail-wrapper {
            position: relative;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
            overflow: hidden;
        }
        .thumbnail-wrapper.selected {
            border-color: #007bff; /* Highlight selected thumbnail */
        }
        .thumbnail-wrapper img {
            width: 70px; /* Small size for thumbnails */
            height: 70px;
            object-fit: cover;
            display: block;
            border-radius: 3px;
        }
        /* Removed .thumbnail-delete-badge styling as it's no longer needed */


        /* Status & Snackbar */
        #status { margin-top: 20px; font-weight: bold; text-align: center; color: #333; min-height: 1.6em; }
        #snackbar {
            visibility: hidden; min-width: 250px; margin-left: -125px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff; text-align: center;
            border-radius: 5px; padding: 16px; position: fixed; z-index: 100;
            left: 50%; bottom: 30px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #snackbar.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s forwards; animation: fadein 0.5s, fadeout 0.5s 2.5s forwards; }
        #retry-comment { margin-left: 10px; background-color: #ffc107; color: #333; padding: 5px 10px; font-size: 13px; border-radius: 3px; vertical-align: middle; }

        @-webkit-keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @-webkit-keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* Step Visibility */
        #upload-section { display: none; }

        /* Hide comment input by default */
        #comment-input-group {
            display: none;
        }

        /* NEU: Zoom-Container verstecken */
        #zoom-container {
             display: none;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Nextcloud Uploader</h1>

        <div id="login-section">
            <h2>Login Details</h2>
            <div class="input-group">
                <label for="username">Nextcloud Benutzername:</label>
                <input type="text" id="username" required autocomplete="username">
            </div>
            <div class="input-group">
                <label for="password">Nextcloud Passwort:</label>
                <input type="password" id="password" required autocomplete="current-password">
            </div>
            <button id="login-proceed-button">Einloggen & Weiter</button>
        </div>

        <div id="upload-section">
            <h2>Foto aufnehmen & hochladen</h2>
             
            <div>
                <button id="start-camera">Kamera nutzen</button>
            </div>
            
            <div class="input-group" id="zoom-container" style="margin-top: 15px;">
                <label for="zoom-slider" style="display: inline-block; width: auto; margin-right: 10px;">Zoom:</label>
                <input type="range" id="zoom-slider" min="1" max="5" value="1" step="0.1" style="width: calc(100% - 70px);">
            </div>
            
            <div class="video-container">
                <video id="video" autoplay playsinline></video>
            </div>
            
            <div id="capture-buttons-container">
                <button id="toggle-flashlight" disabled style="display: none;">Taschenlampe</button>
                <button id="focus-camera-button" disabled style="display: none;">Fokus setzen</button>
                <button id="capture-photo" disabled style="display: none;">Foto aufnehmen</button>
            </div>
            
            <canvas id="canvas" style="display: none;"></canvas>

            <div id="thumbnails-container">
                <p style="color: #999; font-size: 0.9em;">Aufgenommene Fotos erscheinen hier.</p>
            </div>

            <img id="photo-preview" src="#" alt="Foto Vorschau"/>

            <div class="input-group" id="comment-input-group">
                 <label for="comment">Kommentar für ausgewähltes Foto (optional):</label>
                 <input type="text" id="comment">
            </div>


            <div style="text-align: center; margin-top: 5px;">
                <button id="delete-photo-button" disabled style="width: auto; padding: 8px 15px;">Ausgewähltes Foto löschen</button>
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <label for="folder">Unterordner Name (optional, in "Snapshot"):</label>
                <input type="text" id="folder" list="folder-list" placeholder="Neuer Ordner oder auswählen" autocomplete="off">
                <datalist id="folder-list"></datalist>
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <button id="upload-button" disabled>Alle Fotos hochladen</button>
            </div>
        </div>

        <div id="status"></div>
        <div id="snackbar">Benachrichtigung...
            <button id="retry-comment" style="display: none;">Kommentar erneut versuchen</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>